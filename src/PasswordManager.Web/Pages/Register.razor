@page "/register"
@inject HttpClient Http
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@inject NavigationManager Nav

<h3>Créer un compte</h3>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <p class="text-danger">@errorMessage</p>
}

<div>
    <label>Nom d'utilisateur :</label>
    <input @bind="username" class="form-control" />
</div>
<div>
    <label>Mot de passe :</label>
    <input type="password" @bind="password" class="form-control" />
</div>

<button @onclick="RegisterUser" class="btn btn-primary mt-2">S'inscrire</button>

@code {
    private string username = "";
    private string password = "";
    private string errorMessage = "";

    private async Task RegisterUser() // ✅ Nouveau nom pour éviter le conflit
    {
        errorMessage = "";

        var response = await Http.PostAsJsonAsync("auth/register", new
        {
            Username = username,
            PasswordHash = password
        });

        if (response.IsSuccessStatusCode)
        {
            Nav.NavigateTo("/login");
        }
        else
        {
            errorMessage = await response.Content.ReadAsStringAsync();
        }
    }
}

